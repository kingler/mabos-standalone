<?xml version="1.0" encoding="UTF-8"?>
<scxml xmlns="http://www.w3.org/2005/07/scxml" version="1.0" initial="on" datamodel="ecmascript" name="calculator">
  <datamodel>
    <data id="long_expr" />
    <data id="short_expr" expr="0" />
    <data id="res" />
  </datamodel>
  
  <state id="on" initial="ready">
    <onentry>
      <send event="DISPLAY.UPDATE" />
    </onentry>
    
    <state id="ready" initial="begin">
      <state id="begin">
        <transition event="OPER.MINUS" target="negated1" />
        <onentry>
          <send event="DISPLAY.UPDATE" />
        </onentry>
      </state>
      
      <state id="result">
      </state>
      
      <transition event="OPER" target="opEntered" />
      <transition event="DIGIT.0" target="zero1">
        <assign location="short_expr" expr="''" />
      </transition>
      <transition event="DIGIT" target="int1">
        <assign location="short_expr" expr="''" />
      </transition>
      <transition event="POINT" target="frac1">
        <assign location="short_expr" expr="''" />
      </transition>
    </state>
    
    <state id="negated1">
      <onentry>
        <assign location="short_expr" expr="'-'" />
        <send event="DISPLAY.UPDATE" />
      </onentry>
      <transition event="DIGIT.0" target="zero1" />
      <transition event="DIGIT" target="int1" />
      <transition event="POINT" target="frac1" />
    </state>
    
    <state id="operand1">
      <state id="zero1">
        <transition event="DIGIT" cond="_event.data != '0'" target="int1" />
        <transition event="POINT" target="frac1" />
      </state>
      <state id="int1">
        <transition event="DIGIT" target="int1" />
        <transition event="POINT" target="frac1" />
      </state>
      <state id="frac1">
        <transition event="DIGIT" target="frac1" />
      </state>
      <transition event="OPER" target="opEntered" />
    </state>
    
    <state id="opEntered">
      <transition event="DIGIT.0" target="zero2" />
      <transition event="DIGIT" target="int2" />
      <transition event="POINT" target="frac2" />
      <transition event="OPER.MINUS" target="negated2" />
    </state>
    
    <state id="negated2">
      <onentry>
        <assign location="short_expr" expr="short_expr + '-'" />
        <send event="DISPLAY.UPDATE" />
      </onentry>
      <transition event="DIGIT.0" target="zero2" />
      <transition event="DIGIT" target="int2" />
      <transition event="POINT" target="frac2" />
    </state>
    
    <state id="operand2">
      <state id="zero2">
        <transition event="DIGIT" cond="_event.data != '0'" target="int2" />
        <transition event="POINT" target="frac2" />
      </state>
      <state id="int2">
        <transition event="DIGIT" target="int2" />
        <transition event="POINT" target="frac2" />
      </state>
      <state id="frac2">
        <transition event="DIGIT" target="frac2" />
      </state>
      <transition event="OPER" target="opEntered" />
    </state>
  </state>
</scxml>