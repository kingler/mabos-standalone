---
component: db
description: Manages database interactions, models, and database-related utilities for MABOS
main-technologies:
  - Python
  - ArangoDB
  - SQLAlchemy (if used)
conventions:
  - Use SQLAlchemy ORM for relational database interactions
  - Implement database migrations for schema changes
  - Use clear naming conventions for database models and queries
---

# Database Component

This directory contains the database interaction layer, including database models, connection management, and database-related utilities for the MABOS system. It provides a centralized point for managing all database operations.

## Structure

- `__init__.py`: Handles the initialization of the database component and manages the connection setup for the MABOS system. It ensures that the database connections are properly established and closed when needed.

- `database.py`: Contains the core setup for the database, including the creation of the SQLAlchemy engine and session management. It is crucial for managing the lifecycle of database sessions and ensuring efficient interaction with the relational database.

- `database_models.py`: Defines the SQLAlchemy ORM models used in the system. These models represent the structure of the relational database tables and are essential for interacting with the database using Python objects.

- `arangodb.py`: Manages specific operations and utilities for interacting with ArangoDB. It includes functions for establishing connections to the ArangoDB instance and handling database-specific operations.

- `arango_db_client.py`: Provides a client interface for interacting with ArangoDB. It includes methods for executing queries, managing collections, and performing CRUD operations on the ArangoDB database.

- `db_integration.py`: Contains integration utilities for database operations, including functions for creating and managing questions and answers in the database. It also includes methods for handling movie embeddings and searching for similar movies.

- `storage_backend.py`: Implements a storage backend for managing data in ArangoDB. It includes methods for creating collections, inserting documents, and querying the database. It also provides specialized functionality for managing graph data, such as creating vertices and edges, and performing graph queries.

## Key Responsibilities

1. Managing database connections and sessions
2. Defining database models and schemas
3. Implementing database migrations and versioning
4. Providing utility functions for common database operations

## Development Guidelines

- Use async database operations where possible for improved performance
- Implement proper error handling and retries for database operations
- Use database transactions for operations that require atomicity
- Keep database models separate from API models to maintain separation of concerns

## Database Management

When making changes to the database schema:
- Implement and test database migrations
- Update relevant documentation, including any ER diagrams
- Consider the impact on existing data and implement data migration if necessary
- Ensure backwards compatibility or provide upgrade paths

## Query Optimization

- Use database indexes for frequently queried fields
- Optimize complex queries and consider using database-specific features
- Implement query logging and monitoring for performance tuning

## Security Considerations

- Use parameterized queries to prevent SQL injection
- Implement proper access controls and user authentication for database access
- Encrypt sensitive data before storing in the database
- Regularly backup the database and test restoration procedures

## Usage Example

```python
from app.db.database import get_db_session
from app.db.models import User

async def get_user_by_id(user_id: int):
    async with get_db_session() as session:
        user = await session.get(User, user_id)
        return user
```

Remember to update the `README.md` in this directory with any significant changes to the database structure or interaction patterns.